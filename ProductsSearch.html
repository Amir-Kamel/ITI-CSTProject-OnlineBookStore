<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Products</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link href="ProductsSearch.css" rel="stylesheet" />
  </head>
  <body>
    <!-- Fixed Header Section -->
    <div class="fixed-header">
      <h1 style="font-size: 2rem; font-weight: bold;">Products</h1>
      <hr />
      <div class="d-flex justify-content-between align-items-center">
        <div class="search-input">
          <i class="fa-solid fa-magnifying-glass search-icon"></i>
          <input
            type="text"
            class="form-control"
            placeholder="Search by product name"
            aria-label="Search"
            id="searchInput"
            oninput="filterProducts()"
          />
        </div>
      </div>
      <div class="add-product-container mt-2">
        <div class="text-center">
          <span id="productCount"></span>
        </div>
        <button
          class="btn btn-danger"
          type="button"
          onclick="redirectToAddProduct()"
        >
          Add Product
        </button>
      </div>
    </div>

    <div class="container mt-2">
      <div class="product-container">
        <!-- Dynamic product cards will be added here -->
        <div id="productContainer"></div>
      </div>
    </div>

    <script>
      function redirectToAddProduct() {
        window.location.href = "AddProduct.html";
      }

      function product() {
        const productContainer = document.getElementById("productContainer");
        const productCount = document.getElementById("productCount");
        productContainer.innerHTML = ""; // Clear container

        const products = JSON.parse(localStorage.getItem("products")) || [];

        productCount.textContent = `Total Products: ${products.length}`;

        if (products.length === 0) {
          productContainer.innerHTML = "<p>No products available.</p>";
        }

        const categoryNames = ["Comedy", "Novels", "Tragedy"]; // Category mapping

        products.forEach((product, index) => {
          const productCard = document.createElement("div");
          productCard.classList.add("product-card", "mb-3", "p-3", "border", "rounded");
        
          productCard.innerHTML = `
            <div class="d-flex align-items-center">
              <img
                src="${product.image}"
                alt="Product Image"
                class="me-3"
                style="max-width: 150px; max-height: 150px;"
              />
              <div>
                <h5>${product.name}</h5>
                <p>Price: $${product.price}</p>
                <p>Number of copies: ${product.quantity}</p> <!-- Display product quantity -->
                <p>Category: ${categoryNames[product.category - 1]}</p> <!-- Show category name -->
              </div>
            </div>
            <div class="product-actions mt-2">
              <button class="btn btn-outline-secondary btn-sm btn-edit" onclick="editProduct(${index})">Edit</button>
              <button class="btn btn-outline-secondary btn-sm btn-delete" onclick="deleteProduct(${index})">Delete</button>
            </div>
          `;
        
          productContainer.appendChild(productCard);
        });
        
      }

      // Filter products based on search input
      function filterProducts() {
        const searchInput = document
          .getElementById("searchInput")
          .value.toLowerCase();
        const productCards = document.querySelectorAll(".product-card");

        productCards.forEach((card) => {
          const productName = card
            .querySelector("h5")
            .textContent.toLowerCase();
          card.style.display = productName.includes(searchInput) ? "" : "none";
        });
      }

      function deleteProduct(index) {
        const confirmation = confirm(
          "Are you sure you want to delete this product?"
        );

        if (confirmation) {
          const products = JSON.parse(localStorage.getItem("products")) || [];
          products.splice(index, 1);
          localStorage.setItem("products", JSON.stringify(products));
          product(); // Re-render the products after deletion
        }
      }

      function editProduct(index) {
        localStorage.setItem("editProductIndex", index);
        window.location.href = "EditProduct.html";
      }

      // Initialize the page with product data
      window.onload = product;
    </script>
  </body>
</html>
