<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add Products</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link href="Add&Edit.css" rel="stylesheet" />

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body>
    <div class="form-container">
      <div class="dropdown">
        <a
          href="#"
          class="nav-link icons text-secondary-emphasis me-1 dropdown-toggle"
          id="userDropdown"
          role="button"
          data-bs-toggle="dropdown"
          aria-expanded="false"
        >
          Go To
        </a>
        <ul class="dropdown-menu" aria-labelledby="userDropdown">
          <li>
            <a class="dropdown-item" href="../ProductsSearch.html"
              ><i class="fa-solid fa-box"></i> Products Dashboard</a
            >
          </li>
          <li>
            <a class="dropdown-item" href="../profile-page/profile.html"
              ><i class="fa-solid fa-user"></i> Your Profile</a
            >
          </li>
          <li>
            <a class="dropdown-item" href="../HomePage.html"
              ><i class="fa-solid fa-house"></i> Home</a
            >
          </li>
        </ul>
      </div>

      <h2>Add New Product</h2>
      <hr />
      <form id="productForm">
        <div class="row mb-3">
          <div class="col-12">
            <label for="productName" class="form-label"
              >Enter Product Name</label
            >
            <input type="text" class="form-control" id="productName" required />
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-6">
            <label for="productPrice" class="form-label"
              >Enter Product Price</label
            >
            <input
              type="number"
              class="form-control"
              id="productPrice"
              step="any"
              required
            />
          </div>
          <div class="col-md-6">
            <label for="productQuantity" class="form-label"
              >Enter Product Quantity</label
            >
            <input
              type="number"
              class="form-control"
              id="productQuantity"
              min="1"
              required
            />
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-12">
            <label for="productCategory" class="form-label"
              >Select Category</label
            >
            <div class="input-group">
              <select
                class="form-select custom-select"
                id="productCategory"
                required
              >
                <option selected disabled>Select a category</option>
                <option value="1">Comedy</option>
                <option value="2">Novels</option>
                <option value="3">Tragedy</option>
              </select>
            </div>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-12">
            <label for="productDescription" class="form-label"
              >Description</label
            >
            <textarea
              class="form-control"
              id="productDescription"
              style="height: 100px"
              required
            ></textarea>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-12">
            <label for="productImage" class="form-label">Upload Image</label>
            <input
              type="file"
              class="form-control"
              id="productImage"
              accept="image/*"
              required
            />
          </div>
        </div>

        <div class="text-center">
          <button
            type="submit"
            class="btn btn-primary"
            style="font-size: 1.2rem"
          >
            Submit
          </button>
        </div>
      </form>
    </div>

    <script>
        $(document).ready(function () {
            $("#productForm").on("submit", function (event) {
              event.preventDefault(); // Prevent default form submission
          
              let valid = true; // Flag to track if the form is valid
              const productName = $("#productName").val().trim();
              const productPrice = $("#productPrice").val().trim();
              const productQuantity = $("#productQuantity").val().trim();
              const productCategory = $("#productCategory").val().trim();
              const productDescription = $("#productDescription").val().trim();
              const productImage = $("#productImage")[0].files[0];
          
              // Validate Product Name (only letters, numbers, and spaces)
              if (!/^[a-zA-Z0-9\s]+$/.test(productName)) {
                alert("Product name should only contain letters, numbers, and spaces.");
                valid = false;
              }
          
              // Validate Product Price (should be a positive number)
              if (parseFloat(productPrice) <= 0 || isNaN(productPrice)) {
                alert("Product price must be a positive number.");
                valid = false;
              }
          
              // Validate Product Quantity (should be a positive integer)
              if (parseInt(productQuantity) <= 0 || isNaN(productQuantity)) {
                alert("Product quantity must be a positive integer.");
                valid = false;
              }
          
              // Validate Product Category (should be selected)
              if (!productCategory) {
                alert("Please select a category.");
                valid = false;
              }
          
              // Validate Description (should have at least 10 alphabetic characters)
              if ((productDescription.match(/[a-zA-Z]/g) || []).length < 10) {
                alert("Description must contain at least 10 alphabetic characters.");
                valid = false;
              }
          
              // Validate Image (should be a valid image file)
              if (!productImage || !productImage.type.startsWith("image/")) {
                alert("Please upload a valid image.");
                valid = false;
              }
          
              // If all validations pass, check if product exists and save it
              if (valid) {
                const products = JSON.parse(localStorage.getItem("products")) || [];
                const reader = new FileReader();
                reader.onload = function () {
                  const productExists = products.some(
                    (product) =>
                      product.name.toLowerCase() === productName.toLowerCase() ||
                      product.description.toLowerCase() === productDescription.toLowerCase() ||
                      product.image === reader.result // Check if image already exists
                  );
          
                  if (productExists) {
                    alert("This product with the same name, description, or image has already been added.");
                    return; // Prevent saving the duplicate product
                  }
          
                  // Save the product after the validation
                  saveProduct(
                    productName,
                    productPrice,
                    productQuantity,
                    productCategory,
                    productDescription,
                    productImage
                  );
                };
                reader.readAsDataURL(productImage);
              }
            });
          });
          
          function saveProduct(
            name,
            price,
            quantity,
            category,
            description,
            image
          ) {
            // Read image as base64 to store in localStorage
            const reader = new FileReader();
            reader.onload = function () {
              const product = {
                name,
                price,
                quantity,
                category,
                description,
                image: reader.result, // Base64 image
              };
          
              // Get existing products from localStorage or initialize empty array
              const products = JSON.parse(localStorage.getItem("products")) || [];
              products.push(product);
              localStorage.setItem("products", JSON.stringify(products));
          
              alert("Data added successfully!");
          
              // Clear the form data
              $("#productForm")[0].reset();
            };
            reader.readAsDataURL(image);
          }
          
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
